@model PetClinicSystem.Models.AppointmentViewModel

@{
    ViewData["Title"] = (ViewData["Action"] as string) == "Schedule" ? "Schedule New Appointment" : "Edit Appointment";
    ViewData["ActivePage"] = "Appointments";
}

<div class="container-fluid">
    <div class="card shadow-sm">
        <div class="card-body">
            <form asp-action="Edit" method="post" id="editForm">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                <input type="hidden" asp-for="AppointmentId" />

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="PatientId" class="form-label">Patient</label>
                            <select asp-for="PatientId" class="form-select" asp-items="Model.AvailablePets">
                                <option value="">Select Patient</option>
                            </select>
                            <span asp-validation-for="PatientId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="VetId" class="form-label">Veterinarian</label>
                            <select asp-for="VetId" class="form-select" asp-items="Model.AvailableVets">
                                <option value="">Select Veterinarian</option>
                            </select>
                            <span asp-validation-for="VetId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="AppointmentDate" class="form-label">Date & Time</label>
                            <input asp-for="AppointmentDate" type="datetime-local"
                                   class="form-control"
                                   value="@Model.AppointmentDate.ToString("yyyy-MM-ddTHH:mm")" />
                            <span asp-validation-for="AppointmentDate" class="text-danger"></span>
                        </div>
                    </div>


                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="Duration" class="form-label"></label>
                            <select asp-for="Duration" class="form-select">
                                <option value="15">15 minutes</option>
                                <option value="30" selected>30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60">60 minutes</option>
                            </select>
                            <span asp-validation-for="Duration" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Reason" class="form-label">Reason</label>
                            <input asp-for="Reason" class="form-control" value="@Model.Reason" />
                            <span asp-validation-for="Reason" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Notes" class="form-label">Notes</label>
                            <textarea asp-for="Notes" class="form-control" rows="3">@Model.Notes</textarea>
                            <span asp-validation-for="Notes" class="text-danger"></span>
                        </div>
                   
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function() {
            // Initialize date picker with time
            $('#AppointmentDate').datetimepicker({
                format: 'YYYY-MM-DD HH:mm',
                stepping: 15,
                minDate: moment().startOf('day')
            });

            // Load available time slots when vet or date changes
            $('#VetId, #AppointmentDate').change(function() {
                var vetId = $('#VetId').val();
                var date = $('#AppointmentDate').val();

                if (vetId && date) {
                    // Call API to get available slots
                    $.get('/Appointments/GetAvailableSlots', { vetId: vetId, date: date }, function(data) {
                        // Update UI with available slots
                        console.log(data);
                    });
                }
            });
        });

        $(document).ready(function() {
            $('#editForm').submit(function(e) {
                console.log("Form submitting...");
                $('button[type="submit"]').prop('disabled', true)
                    .html('<i class="fas fa-spinner fa-spin me-2"></i>Saving...');
            });
        });

    </script>
}